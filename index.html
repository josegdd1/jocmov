<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Movimiento con Animación</title>
  <style>
    body {
      margin: 0;
      background-color: black;
      overflow: hidden;
      touch-action: none;
    }

    #gameContainer {
      position: relative;
      width: 100vw;
      height: 100vh;
    }

    #character {
      position: absolute;
      width: 32px;
      height: 32px;
      image-rendering: pixelated;
    }

    .controls {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      display: grid;
      grid-template-columns: 60px 60px 60px;
      grid-template-rows: 60px 60px;
      gap: 10px;
      z-index: 10;
    }

    .controls button {
      font-size: 24px;
      background-color: #222;
      color: white;
      border: 2px solid #555;
      border-radius: 8px;
      padding: 10px;
    }

    .empty {
      visibility: hidden;
    }
  </style>
</head>
<body>
  <div id="gameContainer">
    <img id="character" src="abajo_idle.png" alt="Personaje" />
    <div class="controls">
      <div class="empty"></div>
      <button id="up">↑</button>
      <div class="empty"></div>
      <button id="left">←</button>
      <button id="down">↓</button>
      <button id="right">→</button>
    </div>
  </div>

  <script>
    const character = document.getElementById("character");
    const speed = 5;
    let x = window.innerWidth / 2 - 16;
    let y = window.innerHeight / 2 - 16;
    let direction = "down";
    let walkFrame = 0;
    let walking = false;
    let flip = false; // para voltear horizontalmente si va a la izquierda

    const sprites = {
      down: ["https://i.postimg.cc/j2DNKt0k/abajo1.png", "https://i.postimg.cc/7Z2V01RQ/abajo-frente.png", "https://i.postimg.cc/ZqYx2kRX/abajo2.png"],
      up: ["https://i.postimg.cc/gjpVV1fM/arriba1.png", "https://i.postimg.cc/sxJpwwz3/arriba.png", "https://i.postimg.cc/kMNFJXbL/arriba2.png"],
      side: ["https://i.postimg.cc/8CrMq1GK/izquierda1.png", "https://i.postimg.cc/wMFmhM5v/izquierda.png", "https://i.postimg.cc/ncRmrscS/izquierda2.png"]
    };

    function updateSprite(dir, isWalking) {
      if (!isWalking) {
        character.src = sprites[dir][1];
      } else {
        walkFrame = (walkFrame + 1) % 3;
        character.src = sprites[dir][walkFrame];
      }

      // Reflejar imagen si es hacia la izquierda
      character.style.transform = flip
        ? `translate(-50%, -50%) scaleX(-1)`
        : `translate(-50%, -50%) scaleX(1)`;
    }

    function move(dx, dy, newDirection) {
      x = Math.max(0, Math.min(window.innerWidth - 32, x + dx));
      y = Math.max(0, Math.min(window.innerHeight - 32, y + dy));
      direction = newDirection;
      walking = true;
      updateSprite(direction === "left" || direction === "right" ? "side" : direction, true);
      character.style.left = x + "px";
      character.style.top = y + "px";

      // Reflejar si es izquierda
      flip = direction === "left";
    }

    function stopWalking() {
      walking = false;
      updateSprite(direction === "left" || direction === "right" ? "side" : direction, false);
    }

    document.getElementById("up").addEventListener("click", () => {
      move(0, -speed, "up");
      setTimeout(stopWalking, 150);
    });

    document.getElementById("down").addEventListener("click", () => {
      move(0, speed, "down");
      setTimeout(stopWalking, 150);
    });

    document.getElementById("left").addEventListener("click", () => {
      move(-speed, 0, "left");
      setTimeout(stopWalking, 150);
    });

    document.getElementById("right").addEventListener("click", () => {
      move(speed, 0, "right");
      setTimeout(stopWalking, 150);
    });

    window.addEventListener("resize", () => {
      x = Math.min(window.innerWidth - 32, x);
      y = Math.min(window.innerHeight - 32, y);
      character.style.left = x + "px";
      character.style.top = y + "px";
    });

    character.style.left = x + "px";
    character.style.top = y + "px";
  </script>
</body>
</html>
